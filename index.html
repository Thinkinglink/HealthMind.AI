<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#00BFA5">
    <title>HealthMind AI</title>
    <link rel="manifest" href="manifest.json">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        :root {
            --primary: #00BFA5;
            --primary-dark: #00897B;
            --primary-light: #B2DFDB;
            --text-dark: #263238;
            --text-gray: #607D8B;
            --bg-gray: #FAFAFA;
            --white: #FFFFFF;
            --border: #E0E0E0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-gray);
            height: 100vh;
            overflow: hidden;
        }

        .app {
            max-width: 480px;
            margin: 0 auto;
            height: 100vh;
            background: var(--white);
            position: relative;
            overflow: hidden;
        }

        .screen {
            position: absolute;
            width: 100%;
            height: 100%;
            display: none;
            flex-direction: column;
            background: var(--bg-gray);
        }

        .screen.active { display: flex; }

        /* Splash */
        .splash {
            background: var(--primary);
            justify-content: center;
            align-items: center;
            color: white;
        }

        .splash h1 {
            font-size: 36px;
            margin-top: 20px;
        }

        /* Auth */
        .auth-screen {
            background: var(--primary);
            padding: 60px 30px 30px;
            justify-content: space-between;
        }

        .auth-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group input {
            width: 100%;
            padding: 15px;
            border: 1px solid var(--border);
            border-radius: 10px;
            font-size: 16px;
        }

        .btn-primary {
            width: 100%;
            padding: 16px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
        }

        .error { color: #F44336; font-size: 14px; margin-top: 5px; }

        /* Header */
        .header {
            background: var(--primary);
            padding: 20px;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h2 { font-size: 20px; }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: white;
            cursor: pointer;
            overflow: hidden;
        }

        .avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Content */
        .content {
            flex: 1;
            overflow-y: auto;
            padding: 20px 20px 100px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            text-align: center;
            padding: 20px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--text-dark);
        }

        .stat-label {
            font-size: 14px;
            color: var(--text-gray);
            margin-top: 5px;
        }

        /* Bottom Nav */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 480px;
            background: white;
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: space-around;
            padding: 10px 0 25px;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            color: var(--text-gray);
            font-size: 12px;
            cursor: pointer;
            padding: 5px 15px;
        }

        .nav-item.active { color: var(--primary); }

        .nav-item svg {
            width: 24px;
            height: 24px;
            stroke: currentColor;
            fill: none;
        }

        .nav-add {
            width: 56px;
            height: 56px;
            background: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: -28px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,191,165,0.3);
        }

        .nav-add svg {
            width: 28px;
            height: 28px;
            stroke: white;
        }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 480px;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal.active { display: flex; }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 400px;
        }

        .modal-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        .modal-btn {
            aspect-ratio: 1;
            background: var(--primary-light);
            border: none;
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            color: var(--text-dark);
        }

        .modal-btn svg {
            width: 40px;
            height: 40px;
            stroke: var(--primary);
        }

        /* Chat Overlay */
        .chat-overlay {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%) translateY(100%);
            width: 100%;
            max-width: 480px;
            height: 70vh;
            background: white;
            border-radius: 20px 20px 0 0;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.1);
            z-index: 999;
            transition: transform 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .chat-overlay.active {
            transform: translateX(-50%) translateY(0);
        }

        .chat-overlay-header {
            background: var(--primary);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 20px 20px 0 0;
        }

        .chat-close {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Tracking */
        .map-container {
            width: 100%;
            height: 50vh;
            background: var(--bg-gray);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .tracking-timer {
            font-size: 48px;
            font-weight: 700;
            text-align: center;
            margin: 20px 0;
            color: var(--text-dark);
        }

        .tracking-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            padding: 20px;
        }

        .tracking-stat {
            text-align: center;
        }

        .tracking-stat-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
        }

        .tracking-stat-label {
            font-size: 12px;
            color: var(--text-gray);
        }

        .btn-stop {
            margin: 20px;
            padding: 16px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
        }

        /* Chat */
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .message {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 18px;
        }

        .message.user {
            align-self: flex-end;
            background: var(--primary);
            color: white;
        }

        .message.bot {
            align-self: flex-start;
            background: var(--primary-light);
            color: var(--text-dark);
        }

        .chat-input-box {
            padding: 15px 20px 30px;
            background: white;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 10px;
        }

        .chat-input-box input {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid var(--border);
            border-radius: 25px;
            font-size: 15px;
        }

        .send-btn {
            width: 44px;
            height: 44px;
            background: var(--primary);
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .send-btn svg {
            width: 20px;
            height: 20px;
            stroke: white;
        }

        /* Settings */
        .settings-header {
            background: var(--primary);
            padding: 40px 20px;
            text-align: center;
            color: white;
        }

        .settings-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            margin: 0 auto 15px;
            background: white;
            overflow: hidden;
            cursor: pointer;
        }

        .settings-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .settings-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid var(--border);
        }

        .toggle {
            width: 50px;
            height: 28px;
            background: #ccc;
            border-radius: 14px;
            position: relative;
            cursor: pointer;
        }

        .toggle.active {
            background: var(--primary);
        }

        .toggle::after {
            content: '';
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 50%;
            position: absolute;
            top: 2px;
            left: 2px;
            transition: left 0.3s;
        }

        .toggle.active::after {
            left: 24px;
        }

        .btn-danger {
            background: #F44336;
        }

        .workout-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: white;
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .workout-icon {
            width: 40px;
            height: 40px;
            background: var(--primary-light);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .workout-icon svg {
            width: 24px;
            height: 24px;
            stroke: var(--primary);
        }

        .workout-info {
            flex: 1;
        }

        .workout-name {
            font-weight: 600;
            margin-bottom: 3px;
        }

        .workout-details {
            font-size: 13px;
            color: var(--text-gray);
        }

        #fileInput {
            display: none;
        }

        .goal-card {
            background: white;
            border: 2px solid var(--border);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <div class="app">
        <!-- Splash -->
        <div class="screen splash active" id="splash">
            <svg width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                <polyline points="22 4 12 14.01 9 11.01"/>
            </svg>
            <h1>HealthMind AI</h1>
        </div>

        <!-- Login -->
        <div class="screen auth-screen" id="login">
            <div style="text-align: center; color: white; margin-bottom: 40px;">
                <h1 style="font-size: 32px;">Welcome Back</h1>
            </div>
            <div class="auth-content">
                <div class="input-group">
                    <input type="email" id="login-email" placeholder="Email">
                    <div class="error" id="login-error"></div>
                </div>
                <div class="input-group">
                    <input type="password" id="login-password" placeholder="Password">
                </div>
                <button class="btn-primary" onclick="login()">Login</button>
            </div>
            <div style="text-align: center; color: white; margin-top: 20px;">
                <a href="#" onclick="goTo('signup')" style="color: white;">Create Account</a>
            </div>
        </div>

        <!-- Signup -->
        <div class="screen auth-screen" id="signup">
            <div style="text-align: center; color: white; margin-bottom: 40px;">
                <h1 style="font-size: 32px;">Create Account</h1>
            </div>
            <div class="auth-content">
                <div class="input-group">
                    <input type="text" id="signup-name" placeholder="Full Name">
                </div>
                <div class="input-group">
                    <input type="email" id="signup-email" placeholder="Email">
                    <div class="error" id="signup-error"></div>
                </div>
                <div class="input-group">
                    <input type="password" id="signup-password" placeholder="Password">
                </div>
                <button class="btn-primary" onclick="signup()">Sign Up</button>
            </div>
            <div style="text-align: center; color: white; margin-top: 20px;">
                <a href="#" onclick="goTo('login')" style="color: white;">Already have an account?</a>
            </div>
        </div>

        <!-- Dashboard -->
        <div class="screen" id="dashboard">
            <div class="header">
                <div>
                    <h2>Dashboard</h2>
                    <p style="opacity: 0.9; font-size: 14px;" id="greeting">Hi User!</p>
                </div>
                <div class="avatar" onclick="goTo('settings')">
                    <img id="dash-avatar" src="">
                </div>
            </div>
            <div class="content">
                <div class="card">
                    <h3 style="margin-bottom: 15px;">Today's Progress</h3>
                    <div style="display: flex; justify-content: space-around; align-items: center; margin: 20px 0;">
                        <div style="text-align: center;">
                            <svg width="120" height="120" viewBox="0 0 120 120">
                                <circle cx="60" cy="60" r="54" fill="none" stroke="#E0E0E0" stroke-width="8"/>
                                <circle id="steps-circle" cx="60" cy="60" r="54" fill="none" stroke="#00BFA5" stroke-width="8" 
                                    stroke-dasharray="339.292" stroke-dashoffset="339.292" 
                                    transform="rotate(-90 60 60)" stroke-linecap="round"
                                    style="transition: stroke-dashoffset 0.5s ease;"/>
                                <text x="60" y="55" text-anchor="middle" font-size="20" font-weight="bold" fill="#263238" id="steps-circle-value">0</text>
                                <text x="60" y="72" text-anchor="middle" font-size="12" fill="#607D8B">steps</text>
                            </svg>
                            <p style="margin-top: 10px; font-size: 14px; color: #607D8B;">Goal: 10,000</p>
                        </div>
                        <div style="text-align: center;">
                            <svg width="120" height="120" viewBox="0 0 120 120">
                                <circle cx="60" cy="60" r="54" fill="none" stroke="#E0E0E0" stroke-width="8"/>
                                <circle id="calories-circle" cx="60" cy="60" r="54" fill="none" stroke="#FF6B6B" stroke-width="8" 
                                    stroke-dasharray="339.292" stroke-dashoffset="339.292" 
                                    transform="rotate(-90 60 60)" stroke-linecap="round"
                                    style="transition: stroke-dashoffset 0.5s ease;"/>
                                <text x="60" y="55" text-anchor="middle" font-size="20" font-weight="bold" fill="#263238" id="calories-circle-value">0</text>
                                <text x="60" y="72" text-anchor="middle" font-size="12" fill="#607D8B">kcal</text>
                            </svg>
                            <p style="margin-top: 10px; font-size: 14px; color: #607D8B;">Goal: 500</p>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <h3 style="margin-bottom: 15px;">Weekly Activity</h3>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="steps-value">0</div>
                            <div class="stat-label">Steps Today</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="distance-value">0</div>
                            <div class="stat-label" id="distance-label">Miles</div>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <h3 style="margin-bottom: 15px;">Recent Workouts</h3>
                    <div id="recent-workouts"></div>
                </div>
            </div>
            <div class="bottom-nav">
                <div class="nav-item active" onclick="setNav(this, 'dashboard')">
                    <svg viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/></svg>
                    <span>Home</span>
                </div>
                <div class="nav-item" onclick="toggleChat()">
                    <svg viewBox="0 0 24 24"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
                    <span>AI Coach</span>
                </div>
                <div class="nav-add" onclick="showModal()">
                    <svg viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                </div>
                <div class="nav-item" onclick="setNav(this, 'nutrition')">
                    <svg viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                    <span>Nutrition</span>
                </div>
                <div class="nav-item" onclick="setNav(this, 'goals')">
                    <svg viewBox="0 0 24 24"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
                    <span>Goals</span>
                </div>
            </div>
        </div>

        <!-- Nutrition -->
        <div class="screen" id="nutrition">
            <div class="header">
                <h2>Nutrition Log</h2>
                <div class="avatar" onclick="goTo('settings')">
                    <img id="nutrition-avatar" src="">
                </div>
            </div>
            <div class="content">
                <div class="card">
                    <h3>Calories Remaining</h3>
                    <div class="stat-value" style="color: var(--primary); margin: 20px 0;">1,850</div>
                    <p style="color: var(--text-gray);">Goal: 2,000 calories</p>
                </div>
                <div class="card">
                    <h3 style="margin-bottom: 15px;">Today's Meals</h3>
                    <div id="meals-list">
                        <p style="color: var(--text-gray); text-align: center; padding: 20px;">No meals logged yet</p>
                    </div>
                </div>
            </div>
            <div class="bottom-nav">
                <div class="nav-item" onclick="setNav(this, 'dashboard')">
                    <svg viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/></svg>
                    <span>Home</span>
                </div>
                <div class="nav-item" onclick="toggleChat()">
                    <svg viewBox="0 0 24 24"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
                    <span>AI Coach</span>
                </div>
                <div class="nav-add" onclick="showModal()">
                    <svg viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                </div>
                <div class="nav-item active">
                    <svg viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                    <span>Nutrition</span>
                </div>
                <div class="nav-item" onclick="setNav(this, 'goals')">
                    <svg viewBox="0 0 24 24"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
                    <span>Goals</span>
                </div>
            </div>
        </div>

        <!-- Goals -->
        <div class="screen" id="goals">
            <div class="header">
                <h2>My Goals</h2>
                <div class="avatar" onclick="goTo('settings')">
                    <img id="goals-avatar" src="">
                </div>
            </div>
            <div class="content">
                <div class="card" style="background: var(--primary); color: white; text-align: center;">
                    <h3>Great Progress!</h3>
                    <div class="stat-value" style="color: white; margin: 15px 0;" id="goal-calories">0</div>
                    <p>Calories burned this week! Keep it up! ðŸ”¥</p>
                </div>
                <div class="card">
                    <h3 style="margin-bottom: 15px;">Current Goals</h3>
                    <div class="goal-card">
                        <h4>Daily Steps</h4>
                        <div class="stat-value" style="font-size: 24px; margin: 10px 0;">10,000</div>
                        <div style="background: var(--border); height: 8px; border-radius: 4px; overflow: hidden;">
                            <div id="steps-progress" style="background: var(--primary); height: 100%; width: 0%;"></div>
                        </div>
                    </div>
                    <div class="goal-card">
                        <h4>Weekly Run Distance</h4>
                        <div class="stat-value" style="font-size: 24px; margin: 10px 0;">20 <span id="goal-unit">mi</span></div>
                        <div style="background: var(--border); height: 8px; border-radius: 4px; overflow: hidden;">
                            <div id="distance-progress" style="background: var(--primary); height: 100%; width: 0%;"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="bottom-nav">
                <div class="nav-item" onclick="setNav(this, 'dashboard')">
                    <svg viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/></svg>
                    <span>Home</span>
                </div>
                <div class="nav-item" onclick="toggleChat()">
                    <svg viewBox="0 0 24 24"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
                    <span>AI Coach</span>
                </div>
                <div class="nav-add" onclick="showModal()">
                    <svg viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                </div>
                <div class="nav-item" onclick="setNav(this, 'nutrition')">
                    <svg viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                    <span>Nutrition</span>
                </div>
                <div class="nav-item active">
                    <svg viewBox="0 0 24 24"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
                    <span>Goals</span>
                </div>
            </div>
        </div>

        <!-- AI Coach Overlay -->
        <div class="chat-overlay" id="chat-overlay">
            <div class="chat-overlay-header">
                <h2>AI Health Coach</h2>
                <button class="chat-close" onclick="toggleChat()">âœ•</button>
            </div>
            <div class="chat-messages" id="chat">
                <div class="message bot">Hi! I'm your AI health coach. Ask me anything about fitness, nutrition, or wellness!</div>
            </div>
            <div class="chat-input-box">
                <input type="text" id="chat-input" placeholder="Type a message...">
                <button class="send-btn" onclick="sendMessage()">
                    <svg viewBox="0 0 24 24"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
                </button>
            </div>
        </div>

        <!-- Settings -->
        <div class="screen" id="settings">
            <div class="settings-header">
                <div class="settings-avatar" onclick="selectPhoto()">
                    <img id="settings-avatar" src="">
                </div>
                <h2 id="settings-name">User</h2>
                <p id="settings-email"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="780d0b1d0a381d15191114561b1715">[email&#160;protected]</a></p>
            </div>
            <div class="content">
                <div class="card">
                    <h3 style="margin-bottom: 15px;">Preferences</h3>
                    <div class="settings-item">
                        <span>Units: <span id="unit-label">MILES</span></span>
                        <div class="toggle" id="unit-toggle" onclick="toggleUnits()"></div>
                    </div>
                </div>
                <div class="card">
                    <h3 style="margin-bottom: 15px;">Account</h3>
                    <button class="btn-primary btn-danger" onclick="resetData()">Reset All Data</button>
                </div>
                <div class="card">
                    <button class="btn-primary" onclick="logout()">Log Out</button>
                </div>
            </div>
            <div class="bottom-nav">
                <div class="nav-item" onclick="setNav(this, 'dashboard')">
                    <svg viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/></svg>
                    <span>Home</span>
                </div>
                <div class="nav-item" onclick="toggleChat()">
                    <svg viewBox="0 0 24 24"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
                    <span>AI Coach</span>
                </div>
                <div class="nav-add" onclick="showModal()">
                    <svg viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                </div>
                <div class="nav-item" onclick="setNav(this, 'nutrition')">
                    <svg viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                    <span>Nutrition</span>
                </div>
                <div class="nav-item" onclick="setNav(this, 'goals')">
                    <svg viewBox="0 0 24 24"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
                    <span>Goals</span>
                </div>
            </div>
        </div>

        <!-- Tracking -->
        <div class="screen" id="tracking">
            <div class="map-container">
                <div style="text-align: center; color: var(--text-gray);">
                    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                        <circle cx="12" cy="10" r="3"/>
                    </svg>
                    <p>GPS Map Loading...</p>
                    <p style="font-size: 12px;">Make sure you're outdoors</p>
                </div>
            </div>
            <div style="flex: 1; overflow-y: auto;">
                <div class="tracking-timer" id="timer">00:00:00</div>
                <div class="tracking-stats">
                    <div class="tracking-stat">
                        <div class="tracking-stat-value" id="track-distance">0.0</div>
                        <div class="tracking-stat-label" id="track-unit">mi</div>
                    </div>
                    <div class="tracking-stat" id="track-steps-container">
                        <div class="tracking-stat-value" id="track-steps">0</div>
                        <div class="tracking-stat-label">Steps</div>
                    </div>
                    <div class="tracking-stat">
                        <div class="tracking-stat-value" id="track-calories">0</div>
                        <div class="tracking-stat-label">Calories</div>
                    </div>
                </div>
                <button class="btn-stop" onclick="stopWorkout()">STOP</button>
            </div>
        </div>

        <!-- Modal -->
        <div class="modal" id="modal">
            <div class="modal-content">
                <h2 style="text-align: center; margin-bottom: 20px;">Choose Activity</h2>
                <div class="modal-grid">
                    <button class="modal-btn" onclick="startActivity('walking')">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M13 2v8l3 3-3 3v6"/>
                            <path d="M18 9l-5 5"/>
                            <circle cx="13" cy="2" r="1"/>
                        </svg>
                        <span>Walk</span>
                    </button>
                    <button class="modal-btn" onclick="startActivity('running')">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M13 2v6l4 4-4 4v6"/>
                            <path d="M17 8l-4 4"/>
                            <path d="M9 14l-2 2"/>
                            <circle cx="13" cy="2" r="1"/>
                        </svg>
                        <span>Run</span>
                    </button>
                    <button class="modal-btn" onclick="startActivity('cycling')">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="18.5" cy="17.5" r="3.5"/>
                            <circle cx="5.5" cy="17.5" r="3.5"/>
                            <path d="M12 17.5V14l-3-3 4-3 2 3h3"/>
                            <circle cx="17" cy="5" r="1"/>
                        </svg>
                        <span>Bike</span>
                    </button>
                    <button class="modal-btn" onclick="addMeal()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M18 8h1a4 4 0 0 1 0 8h-1"/>
                            <path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"/>
                            <line x1="6" y1="1" x2="6" y2="4"/>
                            <line x1="10" y1="1" x2="10" y2="4"/>
                            <line x1="14" y1="1" x2="14" y2="4"/>
                        </svg>
                        <span>Nutrition</span>
                    </button>
                </div>
                <button class="btn-primary" style="margin-top: 20px;" onclick="closeModal()">Cancel</button>
            </div>
        </div>

        <input type="file" id="fileInput" accept="image/*" onchange="handlePhoto(event)">
    </div>

    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
        const STATE = { user: null, workouts: [], useKM: false, tracking: null };

        function load() {
            const s = localStorage.getItem('hm_state');
            if (s) {
                const d = JSON.parse(s);
                STATE.user = d.user;
                STATE.workouts = d.workouts || [];
                STATE.useKM = d.useKM || false;
            }
        }

        function save() {
            localStorage.setItem('hm_state', JSON.stringify(STATE));
        }

        function goTo(screen) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screen).classList.add('active');
            if (screen === 'dashboard') updateDashboard();
            if (screen === 'goals') updateGoals();
            if (screen === 'settings') updateSettings();
        }

        function setNav(el, screen) {
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            el.classList.add('active');
            goTo(screen);
        }

        function signup() {
            const name = document.getElementById('signup-name').value.trim();
            const email = document.getElementById('signup-email').value.trim();
            const pass = document.getElementById('signup-password').value;
            const err = document.getElementById('signup-error');
            
            if (!name || !email || !pass) { err.textContent = 'Please fill all fields'; return; }
            if (pass.length < 6) { err.textContent = 'Password must be at least 6 characters'; return; }
            if (localStorage.getItem('u_' + email)) { err.textContent = 'Email already registered'; return; }
            
            const user = { name, email, pass, avatar: `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=00BFA5&color=fff` };
            localStorage.setItem('u_' + email, JSON.stringify(user));
            alert('Account created! Please login.');
            goTo('login');
        }

        function login() {
            const email = document.getElementById('login-email').value.trim();
            const pass = document.getElementById('login-password').value;
            const err = document.getElementById('login-error');
            
            if (!email || !pass) { err.textContent = 'Please enter email and password'; return; }
            
            const data = localStorage.getItem('u_' + email);
            if (!data) { err.textContent = 'Account not found'; return; }
            
            const user = JSON.parse(data);
            if (user.pass !== pass) { err.textContent = 'Incorrect password'; return; }
            
            STATE.user = user;
            save();
            goTo('dashboard');
        }

        function logout() {
            if (confirm('Logout?')) {
                STATE.user = null;
                save();
                goTo('login');
            }
        }

        function updateDashboard() {
            if (!STATE.user) return;
            
            document.getElementById('greeting').textContent = `Hi ${STATE.user.name.split(' ')[0]}!`;
            document.getElementById('dash-avatar').src = STATE.user.avatar;
            document.getElementById('nutrition-avatar').src = STATE.user.avatar;
            document.getElementById('goals-avatar').src = STATE.user.avatar;
            
            let steps = 0, dist = 0, calories = 0;
            STATE.workouts.forEach(w => {
                steps += w.steps || 0;
                dist += w.distance || 0;
                calories += w.calories || 0;
            });
            
            document.getElementById('steps-value').textContent = steps.toLocaleString();
            const d = STATE.useKM ? dist : dist * 0.621371;
            document.getElementById('distance-value').textContent = d.toFixed(1);
            document.getElementById('distance-label').textContent = STATE.useKM ? 'Kilometers' : 'Miles';
            
            // Update progress circles
            const stepsProgress = Math.min((steps / 10000), 1);
            const stepsCircle = document.getElementById('steps-circle');
            if (stepsCircle) {
                const circumference = 339.292;
                const offset = circumference - (stepsProgress * circumference);
                stepsCircle.style.strokeDashoffset = offset;
                document.getElementById('steps-circle-value').textContent = steps.toLocaleString();
            }
            
            const caloriesProgress = Math.min((calories / 500), 1);
            const caloriesCircle = document.getElementById('calories-circle');
            if (caloriesCircle) {
                const circumference = 339.292;
                const offset = circumference - (caloriesProgress * circumference);
                caloriesCircle.style.strokeDashoffset = offset;
                document.getElementById('calories-circle-value').textContent = Math.floor(calories);
            }
            
            const recent = document.getElementById('recent-workouts');
            if (STATE.workouts.length === 0) {
                recent.innerHTML = '<p style="color: var(--text-gray); text-align: center; padding: 20px;">No workouts yet</p>';
            } else {
                recent.innerHTML = STATE.workouts.slice(-3).reverse().map(w => {
                    const wd = STATE.useKM ? w.distance : w.distance * 0.621371;
                    return `<div class="workout-item">
                        <div class="workout-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg></div>
                        <div class="workout-info">
                            <div class="workout-name">${w.type}</div>
                            <div class="workout-details">${wd.toFixed(2)} ${STATE.useKM?'km':'mi'} â€¢ ${w.steps} steps</div>
                        </div>
                    </div>`;
                }).join('');
            }
        }

        function toggleChat() {
            const overlay = document.getElementById('chat-overlay');
            overlay.classList.toggle('active');
        }

        function updateGoals() {
            let cal = 0;
            STATE.workouts.forEach(w => cal += w.calories || 0);
            document.getElementById('goal-calories').textContent = Math.floor(cal);
            document.getElementById('goal-unit').textContent = STATE.useKM ? 'km' : 'mi';
            
            let steps = 0, dist = 0;
            STATE.workouts.forEach(w => {
                steps += w.steps || 0;
                dist += w.distance || 0;
            });
            
            const stepsProg = Math.min((steps / 10000) * 100, 100);
            document.getElementById('steps-progress').style.width = stepsProg + '%';
            
            const goal = STATE.useKM ? 32 : 20;
            const distProg = Math.min((dist / goal) * 100, 100);
            document.getElementById('distance-progress').style.width = distProg + '%';
        }

        function updateSettings() {
            if (!STATE.user) return;
            document.getElementById('settings-name').textContent = STATE.user.name;
            document.getElementById('settings-email').textContent = STATE.user.email;
            document.getElementById('settings-avatar').src = STATE.user.avatar;
            
            const toggle = document.getElementById('unit-toggle');
            const label = document.getElementById('unit-label');
            if (STATE.useKM) {
                toggle.classList.add('active');
                label.textContent = 'KM';
            } else {
                toggle.classList.remove('active');
                label.textContent = 'MILES';
            }
        }

        function toggleUnits() {
            STATE.useKM = !STATE.useKM;
            save();
            updateSettings();
            updateDashboard();
            updateGoals();
        }

        function resetData() {
            if (confirm('Delete all workout data? This cannot be undone!')) {
                STATE.workouts = [];
                save();
                alert('Data reset!');
                updateDashboard();
            }
        }

        function selectPhoto() {
            document.getElementById('fileInput').click();
        }

        function handlePhoto(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = (ev) => {
                STATE.user.avatar = ev.target.result;
                localStorage.setItem('u_' + STATE.user.email, JSON.stringify(STATE.user));
                save();
                updateSettings();
                updateDashboard();
            };
            reader.readAsDataURL(file);
        }

        function showModal() {
            document.getElementById('modal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('modal').classList.remove('active');
        }

        function addMeal() {
            closeModal();
            goTo('nutrition');
            alert('Nutrition logging feature - coming soon!');
        }

        let trackTimer = null, trackStart = 0, gpsWatch = null, lastPos = null;

        function startActivity(type) {
            closeModal();
            
            STATE.tracking = { type, start: Date.now(), distance: 0, steps: 0, calories: 0 };
            
            if (type === 'cycling') {
                document.getElementById('track-steps-container').innerHTML = '<div class="tracking-stat-value" id="track-speed">0.0</div><div class="tracking-stat-label">mph</div>';
            }
            
            document.getElementById('track-unit').textContent = STATE.useKM ? 'km' : 'mi';
            goTo('tracking');
            
            trackStart = Date.now();
            trackTimer = setInterval(updateTimer, 1000);
            
            if (navigator.geolocation) {
                gpsWatch = navigator.geolocation.watchPosition(
                    pos => {
                        const curr = { lat: pos.coords.latitude, lon: pos.coords.longitude };
                        if (lastPos) {
                            const d = distance(lastPos.lat, lastPos.lon, curr.lat, curr.lon);
                            STATE.tracking.distance += d;
                            if (type !== 'cycling') STATE.tracking.steps += Math.floor(d * 1250);
                        }
                        lastPos = curr;
                        updateTrackDisplay();
                    },
                    err => console.error(err),
                    { enableHighAccuracy: true }
                );
            }
        }

        function updateTimer() {
            const elapsed = Math.floor((Date.now() - trackStart) / 1000);
            const h = Math.floor(elapsed / 3600);
            const m = Math.floor((elapsed % 3600) / 60);
            const s = elapsed % 60;
            document.getElementById('timer').textContent = 
                `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
        }

        function updateTrackDisplay() {
            if (!STATE.tracking) return;
            const d = STATE.useKM ? STATE.tracking.distance : STATE.tracking.distance * 0.621371;
            document.getElementById('track-distance').textContent = d.toFixed(2);
            
            if (STATE.tracking.type !== 'cycling') {
                document.getElementById('track-steps').textContent = STATE.tracking.steps.toLocaleString();
            }
            
            STATE.tracking.calories = STATE.tracking.distance * 60;
            document.getElementById('track-calories').textContent = Math.floor(STATE.tracking.calories);
        }

        function stopWorkout() {
            if (!STATE.tracking) return;
            
            clearInterval(trackTimer);
            if (gpsWatch) navigator.geolocation.clearWatch(gpsWatch);
            
            STATE.workouts.push({
                type: STATE.tracking.type,
                date: new Date().toISOString(),
                distance: STATE.tracking.distance,
                steps: STATE.tracking.steps,
                calories: STATE.tracking.calories
            });
            
            STATE.tracking = null;
            lastPos = null;
            save();
            
            alert('Workout saved!');
            goTo('dashboard');
        }

        function distance(lat1, lon1, lat2, lon2) {
            const R = 6371;
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                     Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                     Math.sin(dLon/2) * Math.sin(dLon/2);
            return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        }

        const AI = {
            "lose weight": "Focus on a caloric deficit: eat 300-500 calories below maintenance. Combine cardio with strength training 3-4x/week.",
            "build muscle": "Eat 0.8-1g protein per lb bodyweight. Strength train 3-4x/week. Progressive overload is key!",
            "motivated": "Set small achievable goals! Track progress. Find a workout buddy. Remember why you started!",
            "water": "Aim for half your bodyweight in ounces daily. More if exercising!",
            "warm up": "Always warm up 5-10 min before exercise. Light cardio + dynamic stretching prevents injury.",
            "rest": "Rest is crucial! Muscles grow during rest. Take 1-2 rest days per week minimum."
        };

        function sendMessage() {
            const input = document.getElementById('chat-input');
            const msg = input.value.trim().toLowerCase();
            if (!msg) return;
            
            const chat = document.getElementById('chat');
            chat.innerHTML += `<div class="message user">${input.value}</div>`;
            input.value = '';
            
            let reply = "That's a great question! ";
            let found = false;
            
            for (let key in AI) {
                if (msg.includes(key)) {
                    reply += AI[key];
                    found = true;
                    break;
                }
            }
            
            if (!found) {
                if (msg.includes('workout') || msg.includes('exercise')) {
                    reply += "I recommend 3-4 workouts per week. Mix cardio and strength training!";
                } else if (msg.includes('diet') || msg.includes('eat')) {
                    reply += "Focus on whole foods, lean proteins, fruits, vegetables. Avoid processed foods!";
                } else {
                    reply = "I'm here to help with fitness, nutrition, and wellness! Ask me about workouts, diet, or motivation!";
                }
            }
            
            setTimeout(() => {
                chat.innerHTML += `<div class="message bot">${reply}</div>`;
                chat.scrollTop = chat.scrollHeight;
        